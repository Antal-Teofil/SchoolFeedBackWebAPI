<!DOCTYPE html>
<html>
  <head>
    <meta name="google-signin-client_id" content="499857664830-2bdarnf13t5g3j8t3e7pgv46it7tba1b.apps.googleusercontent.com">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <div id="g_id_onload"
         data-client_id="499857664830-2bdarnf13t5g3j8t3e7pgv46it7tba1b.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin" data-type="standard"></div>

    <script>
      async function handleCredentialResponse(response) {
        console.log("ID Token:", response.credential);

        try {
          const res = await fetch('http://localhost:7277/api/auth/login/google', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include',  // important to receive cookies
            body: JSON.stringify({ IdToken: response.credential })
          });

          if (!res.ok) {
            const errorText = await res.text();
            alert("Login failed: " + errorText);
            return;
          }

          const data = await res.json();
          // data should contain email, role, etc.
          console.log("User data from backend:", data);
          alert(`Welcome ${data.email}, role: ${data.role}`);
        } catch (err) {
          console.error(err);
          alert("An error occurred during login");
        }
      }
    </script>
  </body>
</html>
